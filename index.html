<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-touch-fullscreen" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
	<meta name="format-detection" content="telephone=no">
	<meta name="msapplication-tap-highlight" content="no">
	<title> å°çƒæ¸¸æˆ | ç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆ </title>
	<meta name="description" content="å°çƒæ¸¸æˆ - ç§»åŠ¨ç«¯ä¼˜åŒ–ç‰ˆ">
	<meta name="keywords" content="å°çƒ,8çƒ,ä½“è‚²æ¸¸æˆ,æ‰‹æœºæ¸¸æˆ">
	<style type="text/css">
		body{margin:0;padding:0;font-size:12px;background:url(res/wood.jpg); touch-action: manipulation; overflow: hidden;}

/* åŸºç¡€å®¹å™¨æ ·å¼ */
#container {
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    margin: 0;
    padding: 0;
}

/* CanvasåŒ…è£…å™¨ - ç”¨äºç¼©æ”¾ */
#canvasWrapper {
    position: relative;
    transform-origin: center center;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* æ¸¸æˆç”»å¸ƒ - ä¿æŒåŸå§‹å°ºå¯¸ï¼Œé€šè¿‡åŒ…è£…å™¨ç¼©æ”¾ */
#container canvas {
    display: block !important;
    touch-action: manipulation;
    position: static !important;
    left: 0 !important;
    top: 0 !important;
    margin: 0 !important;
}

/* æ¨ªå±æ¨¡å¼æ ·å¼ */
@media (orientation: landscape) {
    #container {
        width: 100vw;
        height: 100vh;
    }
    
    #canvasWrapper {
        /* æ¨ªå±æ—¶ä¸ºæ§åˆ¶æŒ‰é’®é¢„ç•™ç©ºé—´ */
        max-width: 85vw;
        max-height: 90vh;
    }
    
    .virtual-controls {
        display: flex !important;
        flex-direction: column;
        right: 1vw;
        left: auto;
        bottom: 2vh;
        top: auto;
        align-items: center;
        justify-content: flex-end;
        gap: 1.5vh;
        background: rgba(0, 0, 0, 0.3);
        transform-origin: bottom right;
        padding: 1.5vh 1vw;
        border-radius: 20px;
        border: 2px solid rgba(255, 255, 255, 0.2);
    }
    
    .virtual-controls .control-button {
        width: min(9vw, 7vh, 65px);
        height: min(9vw, 7vh, 65px);
        font-size: min(4.5vw, 3.5vh, 22px);
        margin: 0.5vh 0;
        background: rgba(255, 255, 255, 0.4);
        border: 3px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    }
    
    .virtual-controls .control-button.special {
        width: min(11vw, 9vh, 75px);
        height: min(11vw, 9vh, 75px);
        font-size: min(5.5vw, 4.5vh, 26px);
        background: rgba(255, 215, 0, 0.4);
        border-color: rgba(255, 215, 0, 0.9);
    }
    
    .game-status {
        top: 2vh;
        left: 2vw;
        right: auto;
        bottom: auto;
        max-width: 35vw;
    }
}

/* ç«–å±æ¨¡å¼æ ·å¼ */
@media (orientation: portrait) {
    #container {
        width: 100vw;
        height: 100vh;
    }
    
    #canvasWrapper {
        /* ç«–å±æ—¶ä¸ºUIé¢„ç•™æ›´å¤šç©ºé—´ */
        max-width: 95vw;
        max-height: 55vh;
    }
    
    .virtual-controls {
        display: flex !important;
        flex-direction: row;
        left: 50%;
        right: auto;
        bottom: 1vh;
        top: auto;
        transform: translateX(-50%);
        align-items: center;
        justify-content: center;
        gap: 3vw;
        background: rgba(0, 0, 0, 0.3);
        transform-origin: bottom center;
        padding: 1.5vh 4vw;
        border-radius: 25px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        max-width: 90vw;
    }
    
    .virtual-controls .control-button {
        width: min(14vw, 14vh, 70px);
        height: min(14vw, 14vh, 70px);
        font-size: min(6vw, 6vh, 24px);
        margin: 0 1vw;
        background: rgba(255, 255, 255, 0.4);
        border: 3px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    }
    
    .virtual-controls .control-button.special {
        width: min(17vw, 17vh, 85px);
        height: min(17vw, 17vh, 85px);
        font-size: min(7vw, 7vh, 28px);
        background: rgba(255, 215, 0, 0.4);
        border-color: rgba(255, 215, 0, 0.9);
    }
    
    .game-status {
        top: 1vh;
        left: 2vw;
        right: 2vw;
        bottom: auto;
        max-width: none;
        text-align: center;
        font-size: min(3.5vw, 2.5vh, 16px);
        padding: 1vh 2vw;
    }
    
    .game-status div {
        display: inline-block;
        margin: 0 1.5vw;
        white-space: nowrap;
    }
    
    /* éšè—ç«–å±è­¦å‘Š */
    .portrait-warning {
        display: none !important;
    }
}

/* ç«–å±æ¨¡å¼æç¤º */
.portrait-warning {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    color: white;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 9999;
    padding: 20px;
    animation: fadeIn 0.3s ease;
}

.portrait-warning.visible {
    display: flex;
}

.portrait-warning-icon {
    font-size: 64px;
    margin-bottom: 30px;
    animation: rotate 2s ease-in-out infinite;
}

.portrait-warning-text {
    font-size: 20px;
    line-height: 1.6;
    max-width: 300px;
    margin-bottom: 30px;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes rotate {
    0%, 100% { transform: rotate(0deg); }
    50% { transform: rotate(90deg); }
}
		
		/* ç§»åŠ¨ç«¯è™šæ‹Ÿæ§åˆ¶å™¨ */
	.virtual-controls {
		display: none;
		position: fixed;
		right: 2vw;
		bottom: 2vh;
		flex-direction: column;
		gap: 1.5vh;
		z-index: 1001;
		padding: 1.5vh 1.5vw;
		background: rgba(0, 0, 0, 0.1);
		border-radius: 15px;
		backdrop-filter: blur(10px);
		border: 1px solid rgba(255, 255, 255, 0.1);
		/* è‡ªåŠ¨ç¼©æ”¾æ§åˆ¶ */
		transform: scale(1);
		transform-origin: bottom right;
	}

	.virtual-controls .control-button {
		/* ä½¿ç”¨è§†å£å•ä½å®ç°è‡ªåŠ¨ç¼©æ”¾ */
		width: min(8vw, 8vh, 60px);
		height: min(8vw, 8vh, 60px);
		background: rgba(255, 255, 255, 0.3);
		border: 2px solid rgba(255, 255, 255, 0.6);
		border-radius: 50%;
		color: white;
		font-size: min(4vw, 4vh, 20px);
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		backdrop-filter: blur(10px);
		transition: all 0.2s ease;
		box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
		position: relative;
		overflow: hidden;
		touch-action: manipulation;
		-webkit-tap-highlight-color: transparent;
	}

		.virtual-controls .control-button::before {
			content: '';
			position: absolute;
			top: 50%;
			left: 50%;
			width: 0;
			height: 0;
			background: rgba(255, 255, 255, 0.3);
			border-radius: 50%;
			transform: translate(-50%, -50%);
			transition: all 0.3s ease;
		}

		.virtual-controls .control-button:active::before {
			width: 100%;
			height: 100%;
		}

		.virtual-controls .control-button.active {
			background: rgba(255, 255, 255, 0.4);
			transform: scale(0.95);
		}

		.virtual-controls .control-button.special {
			width: min(10vw, 10vh, 80px);
			height: min(10vw, 10vh, 80px);
			background: rgba(255, 215, 0, 0.3);
			border-color: rgba(255, 215, 0, 0.7);
			font-size: min(5vw, 5vh, 24px);
		}

		/* åŠ›åº¦æ˜¾ç¤º */
		.power-indicator {
			position: absolute;
			top: -8px;
			right: -8px;
			width: min(5vw, 5vh, 20px);
			height: min(5vw, 5vh, 20px);
			background: rgba(255, 69, 0, 0.8);
			border-radius: 50%;
			display: none;
			align-items: center;
			justify-content: center;
			font-size: min(2.5vw, 2.5vh, 10px);
			color: white;
			font-weight: bold;
		}

		.power-indicator.visible {
			display: flex;
			animation: pulse 0.5s ease-in-out infinite alternate;
		}

		@keyframes pulse {
			from { transform: scale(1); }
			to { transform: scale(1.2); }
		}

		/* æ¸¸æˆçŠ¶æ€æ˜¾ç¤º - è‡ªåŠ¨ç¼©æ”¾é€‚é… */
		.game-status {
			position: fixed;
			top: 2vh;
			left: 2vw;
			z-index: 1000;
			color: white;
			font-size: min(3.5vw, 2vh, 16px);
			font-weight: bold;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
			background: rgba(0, 0, 0, 0.6);
			padding: 2vh 2vw;
			border-radius: 15px;
			backdrop-filter: blur(10px);
			line-height: 1.5;
			display: none;
			min-width: min(35vw, 140px);
			border: 2px solid rgba(255, 255, 255, 0.2);
			box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
			transform: scale(1);
			transform-origin: top left;
		}

		.game-status div {
			margin: 0.5vh 0;
			white-space: nowrap;
		}

		.game-status span {
			color: #4CAF50;
			font-weight: bold;
		}

		/* ç§»åŠ¨ç«¯ç‰¹æ®Šé€‚é… */
		@media screen and (max-width: 768px) {
			.virtual-controls {
				display: flex;
			}
			
			.game-status {
				display: block;
			}
			
			.orientation-indicator {
				display: block;
			}
			
			/* é˜²æ­¢é¡µé¢æ»šåŠ¨ */
			html, body {
				overflow: hidden;
				position: fixed;
				width: 100%;
				height: 100%;
			}
		}

		/* æ–¹å‘æŒ‡ç¤ºå™¨ */
		.orientation-indicator {
			position: fixed;
			top: 2vh;
			right: 2vw;
			z-index: 1000;
			background: rgba(0, 0, 0, 0.6);
			color: white;
			padding: 1vh 2vw;
			border-radius: 10px;
			font-size: min(3vw, 2vh, 14px);
			display: none;
			align-items: center;
			gap: 1vw;
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255, 255, 255, 0.2);
			transition: all 0.3s ease;
		}

		.orientation-indicator span {
			white-space: nowrap;
		}

		/* æ¨ªå±æ¨¡å¼ä¸‹çš„æ–¹å‘æŒ‡ç¤ºå™¨ */
		@media (orientation: landscape) {
			.orientation-indicator {
				top: 2vh;
				right: 15vw; /* é¿å¼€æ§åˆ¶æŒ‰é’® */
			}
		}

		/* ç«–å±æ¨¡å¼ä¸‹çš„æ–¹å‘æŒ‡ç¤ºå™¨ */
		@media (orientation: portrait) {
			.orientation-indicator {
				top: 8vh; /* é¿å¼€æ¸¸æˆçŠ¶æ€æ  */
				right: 2vw;
			}
		}

		/* å°å±å¹•è®¾å¤‡ä¼˜åŒ– */
		@media screen and (max-width: 480px) {
			.virtual-controls .control-button {
				width: min(12vw, 50px);
				height: min(12vw, 50px);
				font-size: min(6vw, 18px);
			}
			
			.virtual-controls .control-button.special {
				width: min(15vw, 65px);
				height: min(15vw, 65px);
				font-size: min(7vw, 22px);
			}
		}
	</style>
</head>
<body>
	<div id = "container"></div>
<div id = "fps" style = "position:absolute"></div>

<!-- å¯é€‰çš„æ¨ªå±æç¤º (ç°åœ¨æ”¯æŒä¸¤ç§æ–¹å‘ï¼Œå¯ä»¥éšè—æ­¤æç¤º) -->
<div class="portrait-warning" id="portraitWarning" style="display: none;">
    <div class="portrait-warning-icon">ğŸ“±</div>
    <div class="portrait-warning-text">
        æ¸¸æˆç°åœ¨æ”¯æŒæ¨ªå±å’Œç«–å±æ¨¡å¼<br>
        æ¨ªå±æ¨¡å¼å¯è·å¾—æ›´ä½³ä½“éªŒ
        <br><br>
        <button onclick="orientationManager.hideWarning()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
            ç»§ç»­æ¸¸æˆ
        </button>
    </div>
</div>
	
	<!-- ç§»åŠ¨ç«¯è™šæ‹Ÿæ§åˆ¶å™¨ -->
	<div class="virtual-controls" id="virtualControls">
		<button class="control-button" id="powerBtn" title="åŠ›åº¦">
			âš¡
			<div class="power-indicator" id="powerIndicator">0</div>
		</button>
		<button class="control-button special" id="shootBtn" title="å‡»çƒ">ğŸ±</button>
		<button class="control-button" id="resetBtn" title="é‡æ–°å¼€å§‹">ğŸ”„</button>
	</div>

	<!-- æ¸¸æˆçŠ¶æ€æ˜¾ç¤º -->
	<div class="game-status" id="gameStatus">
		<div>ğŸ± å°çƒæ¸¸æˆ</div>
		<div>å¾—åˆ†: <span id="scoreDisplay">0</span></div>
		<div>çƒæ•°: <span id="ballsDisplay">7</span></div>
		<div>çŠ¶æ€: <span id="gameState">å‡†å¤‡å¼€å§‹</span></div>
	</div>

	<!-- æ–¹å‘æŒ‡ç¤ºå™¨ -->
	<div class="orientation-indicator" id="orientationIndicator">
		<span id="orientationIcon">ğŸ“±</span>
		<span id="orientationText">ç«–å±æ¨¡å¼</span>
	</div>

	<script src = "src/quark.base-1.0.0.alpha.min.js"></script>
	<script src = "Taiqiu.js"></script>
	<script src = "mobile-touch-fix.js"></script>
	
	<!-- ç®€åŒ–çš„å…¨å±åŠŸèƒ½å®ç° -->
	<script>
		window.FullscreenUtils = {
			initFullscreen: function(containerId, gameTitle) {
				console.log('å…¨å±åŠŸèƒ½åˆå§‹åŒ– - ' + gameTitle);
			}
		};
		
		// æ–¹å‘ç®¡ç†å™¨
		window.orientationManager = {
			init: function() {
				this.checkOrientation();
				window.addEventListener('orientationchange', () => {
					setTimeout(() => this.checkOrientation(), 100);
				});
				window.addEventListener('resize', () => {
					setTimeout(() => this.checkOrientation(), 100);
				});
			},
			
			checkOrientation: function() {
				const isPortrait = window.innerHeight > window.innerWidth;
				const warning = document.getElementById('portraitWarning');
				
				// ä¸å†æ˜¾ç¤ºç«–å±è­¦å‘Šï¼Œå› ä¸ºç°åœ¨æ”¯æŒä¸¤ç§æ–¹å‘
				this.hideWarning();
				
				// æ ¹æ®æ–¹å‘è°ƒæ•´æ¸¸æˆç•Œé¢
				this.adaptToOrientation(isPortrait);
			},
			
			adaptToOrientation: function(isPortrait) {
				const virtualControls = document.getElementById('virtualControls');
				const gameStatus = document.getElementById('gameStatus');
				const orientationIndicator = document.getElementById('orientationIndicator');
				const orientationIcon = document.getElementById('orientationIcon');
				const orientationText = document.getElementById('orientationText');
				
				if (virtualControls && this.isMobileDevice()) {
					virtualControls.style.display = 'flex';
				}
				
				if (gameStatus && this.isMobileDevice()) {
					gameStatus.style.display = 'block';
				}
				
				// æ›´æ–°æ–¹å‘æŒ‡ç¤ºå™¨
				if (orientationIndicator && this.isMobileDevice()) {
					orientationIndicator.style.display = 'flex';
					if (orientationIcon && orientationText) {
						if (isPortrait) {
							orientationIcon.textContent = 'ğŸ“±';
							orientationText.textContent = 'ç«–å±æ¨¡å¼';
						} else {
							orientationIcon.textContent = 'ğŸ–¥ï¸';
							orientationText.textContent = 'æ¨ªå±æ¨¡å¼';
						}
					}
				}
				
				// è§¦å‘æ¸¸æˆç”»å¸ƒé‡æ–°è°ƒæ•´
				if (window.BallGame && BallGame.stage && BallGame.stage.canvas) {
					setTimeout(() => {
						this.resizeGameCanvas();
					}, 200);
				}
			},
			
			resizeGameCanvas: function() {
				// è§¦å‘ä¸»æ¸¸æˆçš„resizeé€»è¾‘
				window.dispatchEvent(new Event('resize'));
			},
			
			showWarning: function() {
				// ä¸å†æ˜¾ç¤ºè­¦å‘Šï¼Œå› ä¸ºç°åœ¨æ”¯æŒæ‰€æœ‰æ–¹å‘
			},
			
			hideWarning: function() {
				const warning = document.getElementById('portraitWarning');
				if (warning) {
					warning.classList.remove('visible');
				}
			},
			
			isMobileDevice: function() {
				return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Tablet/i.test(navigator.userAgent) || 
					   (window.innerWidth < 768 && 'ontouchstart' in window);
			}
		};
		
		// åˆå§‹åŒ–æ–¹å‘ç®¡ç†å™¨
		document.addEventListener('DOMContentLoaded', function() {
			orientationManager.init();
		});
	</script>
	
	<!-- ç§»åŠ¨ç«¯ä¼˜åŒ–è„šæœ¬ -->
	<script>
		// ç®€åŒ–çš„ç§»åŠ¨è®¾å¤‡æ£€æµ‹
		function isMobileDevice() {
			return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Tablet/i.test(navigator.userAgent) || 
				   (window.innerWidth < 768 && 'ontouchstart' in window);
		}
		
		// åˆå§‹åŒ–è™šæ‹Ÿæ§åˆ¶å™¨
		function initVirtualControls() {
			const shootBtn = document.getElementById('shootBtn');
			const resetBtn = document.getElementById('resetBtn');
			
			// å‡»çƒæŒ‰é’®
			function handleShoot(e) {
				e.preventDefault();
				console.log('ğŸ± Shoot button clicked');
				if (window.BallGame && BallGame.canShot && !BallGame.paused) {
					// ä½¿ç”¨æ™ºèƒ½å‡»çƒåŠŸèƒ½
					if (BallGame.smartShoot) {
						BallGame.smartShoot();
					} else if (BallGame.whiteBall && BallGame.line) {
						// å¤‡ç”¨æ–¹æ³•
						const angle = BallGame.line.rotation * Math.PI / 180;
						const power = BallGame.power || 15;
						const vx = -power * Math.cos(angle);
						const vy = -power * Math.sin(angle);
						BallGame.whiteBall.v.reset(vx, vy);
						BallGame.canShot = false;
					}
				}
			}
			
			shootBtn.addEventListener('touchstart', handleShoot);
			shootBtn.addEventListener('click', handleShoot);
			
			// é‡æ–°å¼€å§‹æŒ‰é’®
			function handleReset(e) {
				e.preventDefault();
				console.log('ğŸ”„ Reset button clicked');
				if (window.BallGame) {
					location.reload();
				}
			}
			
			resetBtn.addEventListener('touchstart', handleReset);
			resetBtn.addEventListener('click', handleReset);
		}
		
		// æ¸¸æˆåˆå§‹åŒ–å‡½æ•°
		function initGameUI() {
			try {
				// ç­‰å¾…BallGameå¯¹è±¡å®Œå…¨åˆå§‹åŒ–
				const checkBallGame = setInterval(() => {
					if (window.BallGame && BallGame.stage) {
						clearInterval(checkBallGame);
						console.log('âœ… BallGameå¯¹è±¡å·²åˆå§‹åŒ–');
						
						// åˆå§‹åŒ–è™šæ‹Ÿæ§åˆ¶å™¨
						initVirtualControls();
						
						// å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œæ˜¾ç¤ºè™šæ‹Ÿæ§åˆ¶å™¨å’Œæ¸¸æˆçŠ¶æ€
						if (isMobileDevice()) {
							document.getElementById('virtualControls').style.display = 'flex';
							document.getElementById('gameStatus').style.display = 'block';
							document.body.style.touchAction = 'manipulation';
							document.body.style.overflow = 'hidden';
							document.documentElement.style.overflow = 'hidden';
							
							console.log('âœ… ç§»åŠ¨ç«¯UIå·²å¯ç”¨');
							
							// å¯åŠ¨æ¸¸æˆçŠ¶æ€æ›´æ–°
							startGameStatusUpdates();
							
							// åº”ç”¨ç§»åŠ¨ç«¯ç”»å¸ƒç¼©æ”¾
							applyMobileCanvasScaling();
							
							// ç›‘å¬æ–¹å‘å˜åŒ–
							window.addEventListener('orientationchange', () => {
								setTimeout(() => {
									adjustUIForOrientation();
									applyMobileCanvasScaling();
								}, 300);
							});
							
							window.addEventListener('resize', () => {
								setTimeout(() => {
									applyMobileCanvasScaling();
								}, 100);
							});
							
							// åˆå§‹è°ƒæ•´
							adjustUIForOrientation();
						}
					}
				}, 100);
				
				// è¶…æ—¶ä¿æŠ¤
				setTimeout(() => {
					clearInterval(checkBallGame);
				}, 5000);
			} catch (error) {
				console.error('æ¸¸æˆUIåˆå§‹åŒ–å¤±è´¥:', error);
			}
		}
		
		// åº”ç”¨ç§»åŠ¨ç«¯ç”»å¸ƒç¼©æ”¾
		function applyMobileCanvasScaling() {
			const checkAndScale = () => {
				let wrapper = document.getElementById('canvasWrapper');
				const canvas = document.querySelector('#container canvas');
				
				if (!canvas) {
					return false;
				}
				
				// å¦‚æœwrapperä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
				if (!wrapper) {
					const container = document.getElementById('container');
					if (!container) return false;
					
					wrapper = document.createElement('div');
					wrapper.id = 'canvasWrapper';
					wrapper.style.position = 'relative';
					wrapper.style.transformOrigin = 'center center';
					wrapper.style.width = '960px';
					wrapper.style.height = '600px';
					
					const parent = canvas.parentNode;
					parent.insertBefore(wrapper, canvas);
					wrapper.appendChild(canvas);
					
					console.log('âœ… Canvas wrapper created');
				}
				
				const container = document.getElementById('container');
				if (!container) return false;
				
				const isPortrait = window.innerHeight > window.innerWidth;
				const containerWidth = container.clientWidth;
				const containerHeight = container.clientHeight;
				
				const gameWidth = 960;
				const gameHeight = 600;
				
				let availableWidth, availableHeight;
				
				if (isPortrait) {
					availableWidth = containerWidth * 0.98;
					availableHeight = containerHeight * 0.50;
				} else {
					availableWidth = containerWidth * 0.80;
					availableHeight = containerHeight * 0.85;
				}
				
				const scaleX = availableWidth / gameWidth;
				const scaleY = availableHeight / gameHeight;
				const scale = Math.min(scaleX, scaleY);
				const finalScale = Math.max(scale, 0.25);
				
				wrapper.style.transform = `scale(${finalScale})`;
				wrapper.style.margin = '0 auto';
				
				canvas.style.position = 'relative';
				canvas.style.display = 'block';
				canvas.style.left = '0';
				canvas.style.top = '0';
				
				// console.log(`âœ… Wrapperç¼©æ”¾: ${finalScale.toFixed(3)} (${isPortrait ? 'ç«–å±' : 'æ¨ªå±'})`);
				
				return true;
			};
			
			if (!checkAndScale()) {
				setTimeout(() => {
					if (!checkAndScale()) {
						setTimeout(checkAndScale, 500);
					}
				}, 200);
			}
		}
		
		// æ ¹æ®æ–¹å‘è°ƒæ•´UI
		function adjustUIForOrientation() {
			const isPortrait = window.innerHeight > window.innerWidth;
			const virtualControls = document.getElementById('virtualControls');
			const gameStatus = document.getElementById('gameStatus');
			
			if (virtualControls) {
				virtualControls.style.display = 'flex';
			}
			
			if (gameStatus) {
				gameStatus.style.display = 'block';
			}
			
			setTimeout(() => {
				window.dispatchEvent(new Event('resize'));
			}, 100);
			
			console.log(`ç•Œé¢å·²è°ƒæ•´ä¸º${isPortrait ? 'ç«–å±' : 'æ¨ªå±'}æ¨¡å¼`);
		}
		
		// æ¸¸æˆçŠ¶æ€æ›´æ–°
		function startGameStatusUpdates() {
			setInterval(() => {
				if (window.BallGame) {
					const scoreDisplay = document.getElementById('scoreDisplay');
					const ballsDisplay = document.getElementById('ballsDisplay');
					const gameState = document.getElementById('gameState');
					
					if (scoreDisplay && BallGame.player1) {
						scoreDisplay.textContent = BallGame.player1.score || 0;
					}
					
					if (ballsDisplay && BallGame.Ball && BallGame.Ball.balls) {
						ballsDisplay.textContent = BallGame.Ball.balls.length || 0;
					}
					
					if (gameState) {
						if (BallGame.paused) {
							gameState.textContent = 'å·²æš‚åœ';
						} else if (BallGame.canShot) {
							gameState.textContent = 'å‡†å¤‡å‡»çƒ';
						} else {
							gameState.textContent = 'çƒåœ¨ç§»åŠ¨';
						}
					}
				}
			}, 500);
		}
		
		// é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹UIåˆå§‹åŒ–
		document.addEventListener('DOMContentLoaded', function() {
			console.log('âœ… DOMå†…å®¹åŠ è½½å®Œæˆ');
			initGameUI();
		});
	</script>
</body>
</html>